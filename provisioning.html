

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Provision a Datacenter &mdash; Elassandra Operator Documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/custom.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced Services" href="advanced-services.html" />
    <link rel="prev" title="Operator setup" href="operator-setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Elassandra-Operator
          

          
            
            <img src="_static/elassandra-operator.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="helm-setup.html">HELM setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator-setup.html">Operator setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Provision a Datacenter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#peristent-storage">Peristent Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#persistent-volume-attached-to-availability-zones">Persistent volume attached to availability zones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#peristent-volume-decommission-policy">Peristent volume decommission policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#network-configuration">Network Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#in-cluster-networking">In-cluster networking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#out-of-cluster-networking-with-private-ip-addressing">Out-of-cluster Networking with private IP addressing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#out-of-cluster-networking-with-public-ip-addressing">Out-of-cluster Networking with Public IP addressing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#external-dns">External DNS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pod-management">Pod management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pod-template">Pod template</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pod-affinity">Pod affinity</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pod-disruption-budget">Pod disruption budget</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#jvm-settings">JVM settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cassandra-settings">Cassandra settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elasticsearch-settings">Elasticsearch settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elassandra-configuration">Elassandra configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced-services.html">Advanced Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="operations.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="multi-dc.html">Mutli-datacenter deployment</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Elassandra-Operator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Provision a Datacenter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/provisioning.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="provision-a-datacenter">
<h1>Provision a Datacenter<a class="headerlink" href="#provision-a-datacenter" title="Permalink to this headline">¶</a></h1>
<p>Before deploying a datacenter, adjust your setting in the HELM values.yaml file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>replicas: 1
parked: false

image:
  elassandraRepository: strapdata/elassandra-node-dev
  tag: 6.8.4.5
  pullPolicy: Always
  pullSecrets: []

# Elassandra node affinity STRICT or SLACK
nodeAffinityPolicy: STRICT
rbacEnabled: true
serviceAccount:
podTemplate:

# Resource config
resources:
  requests:
    cpu: 500m
    memory: 1Gi
  limits:
    cpu: 2000m
    memory: 2Gi

# Storage config
dataVolumeClaim:
  accessModes:
    - ReadWriteOnce
  storageClassName: standard
  resources:
    requests:
      storage: 500Mi
# PVC delete policy, KEEP_PVC or DELETE_PVC
decommissionPolicy: &quot;DELETE_PVC&quot;

# Kubernetes Network config
networking:
  hostPortEnabled: false
  hostNetworkEnabled: false
  nodeLoadBalancerEnabled: false

# When hostNetwork or hostPort is enabled, and k8s node have a public IP address,
# externalDns publish a DNS name for seed nodes allowing to be joined by remote DCs.
externalDns:
  enabled: false
  root: &quot;xxx&quot;
  domain: &quot;example.com&quot;
  ttl: 300

managedKeyspaces: {}
#  - keyspace: gravitee
#    rf: 3
#    role: gravitee
#    login: true
#    superuser: false
#    secretKey: gravitee
#    grantStatements:
#      - &quot;GRANT gravitee TO gravitee&quot;

# JVM config
jvm:
  computeJvmMemorySettings: true
  jdbPort: 4242
  # JMXMP is mandatory
  jmxPort: 7199
  jmxmpEnabled: true
  jmxmpOverSSL: true

# Cassandra configuration
cassandra:
  ssl: true
  authentication: CASSANDRA
  # Tell Cassandra to use the local IP address (INTERNAL_IP).
  snitchPreferLocal: true
  # Cassandra seeds config
  remoteSeeds: []
  remoteSeeders: []
  nativePort: 39042
  storagePort: 37000
  sslStoragePort: 37001

# Cassandra reaper config
reaper:
  image: strapdata/cassandra-reaper:2.1.0-SNAPSHOT-strapkop
  enabled: true
  jwtSecret: &quot;68d45d8f-419f-429e-8ba0-7b475cba795d&quot;
  podTemplate:
  ingressSuffix:
  ingressAnnotations: {}
  loggingLevel: &quot;INFO&quot;

# Elasticsearch config
elasticsearch:
  enabled: true
  httpPort: 9200
  transportPort: 9300
  ingressEnabled: false
  loadBalancerEnabled: false
  loadBalancerIp:
  config: {}
  datacenter:
    group:
    tags: []
  enterprise:
    enabled: true
    jmx: true
    https: true
    ssl: true
    aaa:
      enabled: true
      audit: true
    cbs: true
kibana:
  enabled: true
  image: &quot;docker.elastic.co/kibana/kibana-oss&quot;
  spaces:
    - name: &quot;&quot;
      keyspaces: []
      ingressSuffix:
      ingressAnnotations: {}
      podTemplate:

# Prometheus metrics exporter
prometheus:
  enabled: true
  port: 9500

# Override some config files in /etc/cassandra
configs:
  logback.xml: |-
    &lt;!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    &quot;License&quot;); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
    --&gt;

    &lt;configuration scan=&quot;true&quot; debug=&quot;false&quot;&gt;
    &lt;jmxConfigurator /&gt;
    &lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
    &lt;file&gt;${CASSANDRA_LOGDIR}/system.log&lt;/file&gt;
    &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.FixedWindowRollingPolicy&quot;&gt;
    &lt;fileNamePattern&gt;${CASSANDRA_LOGDIR}/system.log.%i.zip&lt;/fileNamePattern&gt;
    &lt;minIndex&gt;1&lt;/minIndex&gt;
    &lt;maxIndex&gt;20&lt;/maxIndex&gt;
    &lt;/rollingPolicy&gt;

    &lt;triggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;
    &lt;maxFileSize&gt;500MB&lt;/maxFileSize&gt;
    &lt;/triggeringPolicy&gt;
    &lt;encoder&gt;
    &lt;pattern&gt;%date{ISO8601} %-5level [%thread] %F:%L %M %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
    &lt;encoder&gt;
    &lt;pattern&gt;%date{ISO8601} %-5level [%thread] %C.%M:%L %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;appender name=&quot;AUDIT&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
    &lt;file&gt;${CASSANDRA_LOGDIR}/audit.log&lt;/file&gt;
    &lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.FixedWindowRollingPolicy&quot;&gt;
    &lt;fileNamePattern&gt;${CASSANDRA_LOGDIR}/audit.log.%i.zip&lt;/fileNamePattern&gt;
    &lt;minIndex&gt;1&lt;/minIndex&gt;
    &lt;maxIndex&gt;20&lt;/maxIndex&gt;
    &lt;/rollingPolicy&gt;
    &lt;triggeringPolicy class=&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;&gt;
    &lt;maxFileSize&gt;500MB&lt;/maxFileSize&gt;
    &lt;/triggeringPolicy&gt;
    &lt;encoder&gt;
    &lt;pattern&gt;%date{ISO8601} %msg%n&lt;/pattern&gt;
    &lt;/encoder&gt;
    &lt;/appender&gt;

    &lt;logger name=&quot;com.thinkaurelius.thrift&quot; level=&quot;ERROR&quot;/&gt;
    &lt;logger name=&quot;org.apache&quot; level=&quot;WARN&quot; /&gt;

    &lt;!-- Use env variables to customize logging level from docker --&gt;
    &lt;logger name=&quot;org.apache.cassandra&quot; level=&quot;${LOGBACK_org_apache_cassandra:-WARN}&quot; /&gt;
    &lt;logger name=&quot;org.apache.cassandra.service.CassandraDaemon&quot; level=&quot;${LOGBACK_org_apache_cassandra_service_CassandraDaemon:-INFO}&quot; /&gt;
    &lt;logger name=&quot;org.elassandra.shard&quot; level=&quot;${LOGBACK_org_elassandra_shard:-INFO}&quot; /&gt;
    &lt;logger name=&quot;org.elassandra.indices&quot; level=&quot;${LOGBACK_org_elassandra_indices:-INFO}&quot; /&gt;
    &lt;logger name=&quot;org.elassandra.index&quot; level=&quot;${LOGBACK_org_elassandra_index:-WARN}&quot; /&gt;
    &lt;logger name=&quot;org.elassandra.discovery&quot; level=&quot;${LOGBACK_org_elassandra_discovery:-WARN}&quot; /&gt;
    &lt;logger name=&quot;org.elasticsearch.cluster.service&quot; level=&quot;${LOGBACK_org_elassandra_cluster_service:-DEBUG}&quot; /&gt;
    &lt;logger name=&quot;org.elasticsearch.cluster.metadata&quot; level=&quot;DEBUG&quot; /&gt;
    &lt;logger name=&quot;org.elasticsearch&quot; level=&quot;${LOGBACK_org_elasticsearch:-WARN}&quot; /&gt;

    &lt;root level=&quot;INFO&quot;&gt;
      &lt;appender-ref ref=&quot;STDOUT&quot; /&gt;
    &lt;/root&gt;
    &lt;logger name=&quot;LogbackAuditor&quot; level=&quot;DEBUG&quot; additivity=&quot;false&quot; &gt;
       &lt;appender-ref ref=&quot;AUDIT&quot; /&gt;
    &lt;/logger&gt;

    &lt;/configuration&gt;
</pre></div>
</div>
<p>Once HELM is installed (see <span class="xref std std-ref">helm-setup</span>), deploy an Elassandra Datacenter in a dedicated namespace <strong>ns1</strong> with 1 replica:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">install</span> <span class="o">--</span><span class="n">namespace</span> <span class="s2">&quot;ns1&quot;</span> <span class="o">--</span><span class="n">name</span> <span class="s2">&quot;ns1-cl1-dc1&quot;</span> <span class="o">-</span><span class="n">f</span> <span class="n">values</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">wait</span> <span class="n">strapdata</span><span class="o">/</span><span class="n">elassandra</span><span class="o">-</span><span class="n">datacenter</span>
</pre></div>
</div>
<div class="section" id="peristent-storage">
<h2>Peristent Storage<a class="headerlink" href="#peristent-storage" title="Permalink to this headline">¶</a></h2>
<p>Elassandra nodes require persistent volumes to store Cassandra and Elasticsearch data.
You can use various kubernetes storage class including local and attached volumes.
Usage of SSD disks is recommended for better performances.</p>
<p>To specify the persistence characteristics for each Elassandra node, you can describe a <a class="reference external" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.12/#persistentvolumeclaimspec-v1-core">PersistentVolumeClaimSpec</a> as “dataVolumeClaim” value.</p>
<div class="section" id="persistent-volume-attached-to-availability-zones">
<h3>Persistent volume attached to availability zones<a class="headerlink" href="#persistent-volume-attached-to-availability-zones" title="Permalink to this headline">¶</a></h3>
<p>The Elassandra operator deploys one Cassandra rack per availability zone to ensure data consistency when a zone is unavailable.
Each Cassandra rack is a Kubernetes StatefulSet, and rack names are Kubernetes node label <code class="docutils literal notranslate"><span class="pre">failure-domain.beta.kubernetes.io/zone</span></code>.</p>
<p>In order to create Persistent Volume in the same availability zone as the StatefulSet,
you may create storage classes bound to availability zones of your cloud provider, as shown bellow using SSDs in GKE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">storage</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">StorageClass</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">ssd</span><span class="o">-</span><span class="n">b</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">addonmanager</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">mode</span><span class="p">:</span> <span class="n">EnsureExists</span>
    <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">cluster</span><span class="o">-</span><span class="n">service</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span>
<span class="n">provisioner</span><span class="p">:</span> <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">gce</span><span class="o">-</span><span class="n">pd</span>
<span class="n">parameters</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">pd</span><span class="o">-</span><span class="n">ssd</span>
<span class="n">allowVolumeExpansion</span><span class="p">:</span> <span class="n">true</span>
<span class="n">reclaimPolicy</span><span class="p">:</span> <span class="n">Delete</span>
<span class="n">volumeBindingMode</span><span class="p">:</span> <span class="n">WaitForFirstConsumer</span>
<span class="n">allowedTopologies</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">matchLabelExpressions</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">key</span><span class="p">:</span> <span class="n">failure</span><span class="o">-</span><span class="n">domain</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">zone</span>
        <span class="n">values</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">europe</span><span class="o">-</span><span class="n">west1</span><span class="o">-</span><span class="n">b</span>
</pre></div>
</div>
<p>In the Elassandra datacenter spec, you can then specify a <code class="docutils literal notranslate"><span class="pre">storageClassName</span></code> ìncluding a <strong>{zone}</strong> variable replaced
by the corresponding availability zone name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataVolumeClaim</span><span class="p">:</span>
  <span class="n">accessModes</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
  <span class="n">storageClassName</span><span class="p">:</span> <span class="s2">&quot;ssd-</span><span class="si">{zone}</span><span class="s2">&quot;</span>
  <span class="n">resources</span><span class="p">:</span>
    <span class="n">requests</span><span class="p">:</span>
      <span class="n">storage</span><span class="p">:</span> <span class="mi">128</span><span class="n">Gi</span>
</pre></div>
</div>
</div>
<div class="section" id="peristent-volume-decommission-policy">
<h3>Peristent volume decommission policy<a class="headerlink" href="#peristent-volume-decommission-policy" title="Permalink to this headline">¶</a></h3>
<p>When deleting an Elassandra datacenter CRD, Elassandra PVCs are deleted.
If you want to keep PVCs, add the following in your datacenter spec.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">decommissionPolicy</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">pvc</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When scaling down the datacenter, PVC of removed Elassandra nodes are kept and you must delete these PVCs before scaling up,
otherwise persistent volume are re-used.</p>
</div>
</div>
</div>
<div class="section" id="network-configuration">
<h2>Network Configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h2>
<p>The Elassandra Operator can deploy datacenters in 3 networking configuration controlled by the following datacenter spec block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">networking</span><span class="p">:</span>
  <span class="n">hostPortEnabled</span><span class="p">:</span> <span class="n">false</span>
  <span class="n">hostNetworkEnabled</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<div class="section" id="in-cluster-networking">
<h3>In-cluster networking<a class="headerlink" href="#in-cluster-networking" title="Permalink to this headline">¶</a></h3>
<p>This is the default networking configuration where Cassandra and Elasticsearch pods listen on PODs private IP addresses.
In such configuration, Elassandra pods can only be reached by applications deployed in the same Kubernetes cluster through a headless service.</p>
</div>
<div class="section" id="out-of-cluster-networking-with-private-ip-addressing">
<h3>Out-of-cluster Networking with private IP addressing<a class="headerlink" href="#out-of-cluster-networking-with-private-ip-addressing" title="Permalink to this headline">¶</a></h3>
<p>In this configuration, Elassandra pods should be deployed with kubernetes <code class="docutils literal notranslate"><span class="pre">hostPort</span></code> enabled to allow the inbound traffic
on Elassandra ports (Cassandra Native and Storage, Elasticsearch HTTP/HTTPS port) from the outside of the Kubernetes cluster.</p>
<p>This allows Elassandra pod to bind and broadcast Kubernetes node private IP address to interconnect datacenters through VPN or PVC.</p>
</div>
<div class="section" id="out-of-cluster-networking-with-public-ip-addressing">
<h3>Out-of-cluster Networking with Public IP addressing<a class="headerlink" href="#out-of-cluster-networking-with-public-ip-addressing" title="Permalink to this headline">¶</a></h3>
<p>In this configuration, Elassandra pods broadcast a public IP should be deployed with <code class="docutils literal notranslate"><span class="pre">hostNetwork</span></code> enabled, allowing Elassandra pods
to bind and broadcast public IP address of their Kubernetes nodes. In such configuration, cross datacenter connection
can rely on public IP addresses without the need of a VPN or a VPC.</p>
</div>
<div class="section" id="external-dns">
<h3>External DNS<a class="headerlink" href="#external-dns" title="Permalink to this headline">¶</a></h3>
<p>When Out-of-cluster networking is enabled, the <strong>externalDns</strong> section allows to automatically
publish DNS names for Elassandra nodes for remote CQL connections and multi-datacenter interconnections.
In this case, the <strong>nodeinfo</strong> init-container of Elassandra nodes
publishes a <a class="reference external" href="https://github.com/kubernetes-sigs/external-dns/blob/a7ac4f9b1e26edea01068dbcedbdd55b1f56165b/docs/contributing/crd-source/dnsendpoint-example.yaml">DNSEndpoint</a>
CRD managed by the deployed <a class="reference external" href="https://github.com/kubernetes-sigs/external-dns">ExternalDNS operator</a>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td colspan="3"><p><a class="reference external" href="urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:ExternalDns">urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:ExternalDns</a></p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>External DNS configuration</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="2"><p><em>object</em></p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>properties</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>enabled</p></li>
</ul>
</td>
<td colspan="2"><p>Enable External DNS configuration</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>root</p></li>
</ul>
</td>
<td colspan="2"><p>Unique root used to publish DNS names for elassandra seed nodes in the form cassandra-{root}-{idx}.{domain}</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>string</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>domain</p></li>
</ul>
</td>
<td colspan="2"><p>External DNS domain</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>string</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>ttl</p></li>
</ul>
</td>
<td colspan="2"><p>External DNS record TTL</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>integer</em></p></td>
</tr>
</tbody>
</table>
<p>See the <a class="reference external" href="https://github.com/helm/charts/tree/master/stable/external-dns">External DNS</a> to install and configure the ExternalDNS in your Kubernetes cluster.</p>
</div>
</div>
<div class="section" id="pod-management">
<h2>Pod management<a class="headerlink" href="#pod-management" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pod-template">
<h3>Pod template<a class="headerlink" href="#pod-template" title="Permalink to this headline">¶</a></h3>
<p>You can customize Elassandra, Cassandra Reaper and Kibana pods by providing your
own <a class="reference external" href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/#pod-templates">PodTemplate</a>.
Thus, you can add labels, annotations, initContainers, environment variables, specify serviceAccount or priorityClassName, or customize resources.</p>
<p>For example, you can install custom Elasticsearch plugins before the elassandra container starts with
an <a class="reference external" href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/">initContainer</a>, as shown bellow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">podTemplate</span><span class="p">:</span>
  <span class="n">spec</span><span class="p">:</span>
    <span class="n">initContainers</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">install</span><span class="o">-</span><span class="n">plugins</span>
      <span class="n">command</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">sh</span>
      <span class="o">-</span> <span class="o">-</span><span class="n">c</span>
      <span class="o">-</span> <span class="o">|</span>
        <span class="nb">bin</span><span class="o">/</span><span class="n">elasticsearch</span><span class="o">-</span><span class="n">plugin</span> <span class="n">install</span> <span class="o">--</span><span class="n">batch</span> <span class="n">plugin</span><span class="o">-</span><span class="n">xxx</span>
</pre></div>
</div>
</div>
<div class="section" id="pod-affinity">
<h3>Pod affinity<a class="headerlink" href="#pod-affinity" title="Permalink to this headline">¶</a></h3>
<p>You can define the <a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity">NodeAffinity</a>
for the Elassandra pods using the <code class="docutils literal notranslate"><span class="pre">nodeAffinityPolicy</span></code> attribute of the DatacenterSpec. Possible values are :</p>
<ul class="simple">
<li><p>STRICT : schedule elassandra pods only on nodes in the matching the <code class="docutils literal notranslate"><span class="pre">failure-domain.beta.kubernetes.io/zone</span></code> label (default value)</p></li>
<li><p>SLACK  : schedule elassandra pods preferably on nodes in the matching the <code class="docutils literal notranslate"><span class="pre">failure-domain.beta.kubernetes.io/zone</span></code> label</p></li>
</ul>
<p>Of course, when <code class="docutils literal notranslate"><span class="pre">hostNetwork</span></code> or <code class="docutils literal notranslate"><span class="pre">hostPort</span></code> is enabled (see Networking), using the SLACK affinity is not possible because all Elassandra nodes
of a cluster listen on the same TCP ports.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In order to test the elassandra operator in a <a class="reference external" href="https://kind.sigs.k8s.io/docs/user/quick-start/">kind cluster</a>,
you just need to add <code class="docutils literal notranslate"><span class="pre">failure-domain.beta.kubernetes.io/zone</span></code> label to your kubernetes nodes, as shown in
the following example with 3 workers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">label</span> <span class="n">nodes</span> <span class="n">cluster1</span><span class="o">-</span><span class="n">worker</span> <span class="n">failure</span><span class="o">-</span><span class="n">domain</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">zone</span><span class="o">=</span><span class="n">a</span>
<span class="n">kubectl</span> <span class="n">label</span> <span class="n">nodes</span> <span class="n">cluster1</span><span class="o">-</span><span class="n">worker2</span> <span class="n">failure</span><span class="o">-</span><span class="n">domain</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">zone</span><span class="o">=</span><span class="n">b</span>
<span class="n">kubectl</span> <span class="n">label</span> <span class="n">nodes</span> <span class="n">cluster1</span><span class="o">-</span><span class="n">worker3</span> <span class="n">failure</span><span class="o">-</span><span class="n">domain</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">zone</span><span class="o">=</span><span class="n">c</span>
</pre></div>
</div>
<p>You can also temporarily disable a Kubernetes node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">node</span> <span class="n">cluster1</span><span class="o">-</span><span class="n">worker</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;{&quot;spec&quot;:{&quot;unschedulable&quot;:true}}&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pod-disruption-budget">
<h3>Pod disruption budget<a class="headerlink" href="#pod-disruption-budget" title="Permalink to this headline">¶</a></h3>
<p>For each datacenter, the Elassandra operator creates a <a class="reference external" href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">PodDisruptionBudget</a>
to stop only one Elassandra pod at a time during a rolling restart. In some edge cases, you might update the <code class="docutils literal notranslate"><span class="pre">maxPodUnavailable</span></code> in your Elassandra
datacenter spec.</p>
<p>As an example, here is the deployed PodDisruptionBudget for a 3 nodes datacenter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">pdb</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">List</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">resourceVersion</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="n">selfLink</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="n">items</span><span class="p">:</span>
<span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">policy</span><span class="o">/</span><span class="n">v1beta1</span>
  <span class="n">kind</span><span class="p">:</span> <span class="n">PodDisruptionBudget</span>
  <span class="n">metadata</span><span class="p">:</span>
    <span class="n">annotations</span><span class="p">:</span>
      <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">datacenter</span><span class="o">-</span><span class="n">generation</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">creationTimestamp</span><span class="p">:</span> <span class="s2">&quot;2020-06-08T16:00:34Z&quot;</span>
    <span class="n">generation</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">labels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">elassandra</span>
      <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">managed</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">operator</span>
      <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cluster</span><span class="p">:</span> <span class="n">cl1</span>
      <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">datacenter</span><span class="p">:</span> <span class="n">dc1</span>
      <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">parent</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="n">ns6</span>
    <span class="n">ownerReferences</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1beta1</span>
      <span class="n">blockOwnerDeletion</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">controller</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">ElassandraDatacenter</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span>
      <span class="n">uid</span><span class="p">:</span> <span class="n">e8d88395</span><span class="o">-</span><span class="mf">9e6</span><span class="n">f</span><span class="o">-</span><span class="mi">4</span><span class="n">c1a</span><span class="o">-</span><span class="mi">9</span><span class="n">a75</span><span class="o">-</span><span class="mi">43</span><span class="n">bc4c44dae8</span>
    <span class="n">resourceVersion</span><span class="p">:</span> <span class="s2">&quot;15879&quot;</span>
    <span class="n">selfLink</span><span class="p">:</span> <span class="o">/</span><span class="n">apis</span><span class="o">/</span><span class="n">policy</span><span class="o">/</span><span class="n">v1beta1</span><span class="o">/</span><span class="n">namespaces</span><span class="o">/</span><span class="n">ns6</span><span class="o">/</span><span class="n">poddisruptionbudgets</span><span class="o">/</span><span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span>
    <span class="n">uid</span><span class="p">:</span> <span class="mi">2</span><span class="n">b8bc2f7</span><span class="o">-</span><span class="mi">64</span><span class="n">ca</span><span class="o">-</span><span class="mi">4</span><span class="n">a0b</span><span class="o">-</span><span class="mi">9</span><span class="n">fea</span><span class="o">-</span><span class="n">b7052fbf4480</span>
  <span class="n">spec</span><span class="p">:</span>
    <span class="n">maxUnavailable</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">selector</span><span class="p">:</span>
      <span class="n">matchLabels</span><span class="p">:</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">elassandra</span>
        <span class="n">app</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">managed</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">operator</span>
        <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cluster</span><span class="p">:</span> <span class="n">cl1</span>
        <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">datacenter</span><span class="p">:</span> <span class="n">dc1</span>
        <span class="n">elassandra</span><span class="o">.</span><span class="n">strapdata</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">parent</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span>
  <span class="n">status</span><span class="p">:</span>
    <span class="n">currentHealthy</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">desiredHealthy</span><span class="p">:</span> <span class="mi">2</span>
    <span class="n">disruptionsAllowed</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">expectedPods</span><span class="p">:</span> <span class="mi">3</span>
    <span class="n">observedGeneration</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="jvm-settings">
<h3>JVM settings<a class="headerlink" href="#jvm-settings" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td colspan="3"><p><a class="reference external" href="urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:Jvm">urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:Jvm</a></p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>JVM configuration</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="2"><p><em>object</em></p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>properties</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>computeJvmMemorySettings</p></li>
</ul>
</td>
<td colspan="2"><p>Automatic heap and GC configuration</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>jmxPort</p></li>
</ul>
</td>
<td colspan="2"><p>Java JMX port</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>integer</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>jmxmpEnabled</p></li>
</ul>
</td>
<td colspan="2"><p>Enable JMXMP</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>jmxmpOverSSL</p></li>
</ul>
</td>
<td colspan="2"><p>Enable SSL on JMXMP</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>jdbPort</p></li>
</ul>
</td>
<td colspan="2"><p>Java debugger port, default is disabled</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p><em>integer</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cassandra-settings">
<h3>Cassandra settings<a class="headerlink" href="#cassandra-settings" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td colspan="4"><p><a class="reference external" href="urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:Cassandra">urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:Cassandra</a></p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>Cassandra configuration</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="3"><p><em>object</em></p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>properties</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>workload</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>string</em></p></td>
</tr>
<tr class="row-even"><td><p>enum</p></td>
<td colspan="2"><p>WRITE, READ_WRITE, READ</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>config</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>object</em></p></td>
</tr>
<tr class="row-even"><td><p>additionalProperties</p></td>
<td><p>type</p></td>
<td><p><em>any</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>authentication</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>string</em></p></td>
</tr>
<tr class="row-even"><td><p>enum</p></td>
<td colspan="2"><p>NONE, CASSANDRA, LDAP</p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>ssl</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>commitlogsInitContainer</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>snitchPreferLocal</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-even"><td rowspan="3"><ul class="simple">
<li><p>remoteSeeds</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>array</em></p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>items</p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>type</p></td>
<td><p><em>string</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><ul class="simple">
<li><p>remoteSeeders</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>array</em></p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>items</p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>type</p></td>
<td><p><em>string</em></p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>nativePort</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>integer</em></p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>storagePort</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>integer</em></p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>sslStoragePort</p></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>integer</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="elasticsearch-settings">
<h3>Elasticsearch settings<a class="headerlink" href="#elasticsearch-settings" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<tbody>
<tr class="row-odd"><td colspan="5"><p><a class="reference external" href="urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:Elasticsearch">urn:jsonschema:com:strapdata:strapkop:model:k8s:datacenter:Elasticsearch</a></p></td>
</tr>
<tr class="row-even"><td colspan="5"><p>Elasticsearch configuration</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="4"><p><em>object</em></p></td>
</tr>
<tr class="row-even"><td colspan="5"><p>properties</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>enabled</p></li>
</ul>
</td>
<td colspan="4"><p>Enable Elasticsearch, default is true</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>httpPort</p></li>
</ul>
</td>
<td colspan="4"><p>Elasticsearch HTTP port, default is 9200</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>integer</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>transportPort</p></li>
</ul>
</td>
<td colspan="4"><p>Elasticsearch transport port, default is 9300</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>integer</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>loadBalancerEnabled</p></li>
</ul>
</td>
<td colspan="4"><p>Create a Load balancer service with external IP for Elasticsearch, default is false</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>loadBalancerIp</p></li>
</ul>
</td>
<td colspan="4"><p>Add a LoadBalancer exposing CQL and elasticsearch HTTP nodePorts</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>string</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>ingressEnabled</p></li>
</ul>
</td>
<td colspan="4"><p>Enable Elasticsearch service ingress</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="3"><ul class="simple">
<li><p>ingressAnnotations</p></li>
</ul>
</td>
<td colspan="4"><p>Elasticsearch ingress annotations</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="3"><p><em>object</em></p></td>
</tr>
<tr class="row-odd"><td><p>additionalProperties</p></td>
<td><p>type</p></td>
<td colspan="2"><p><em>string</em></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><ul class="simple">
<li><p>datacenterGroup</p></li>
</ul>
</td>
<td colspan="4"><p>Elassandra datacenter group</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="3"><p><em>string</em></p></td>
</tr>
<tr class="row-even"><td rowspan="4"><ul class="simple">
<li><p>datacenterTags</p></li>
</ul>
</td>
<td colspan="4"><p>Elassandra datacenter tags</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="3"><p><em>array</em></p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>items</p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>type</p></td>
<td colspan="2"><p><em>string</em></p></td>
</tr>
<tr class="row-even"><td rowspan="18"><ul class="simple">
<li><p>enterprise</p></li>
</ul>
</td>
<td colspan="4"><p>Elassandra enterprise configuration</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="3"><p><em>object</em></p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>properties</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>enabled</p></li>
</ul>
</td>
<td colspan="3"><p>Enable Elassandra Enterprise</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>jmx</p></li>
</ul>
</td>
<td colspan="3"><p>Enable JMX for Elasticsearch metrics</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>https</p></li>
</ul>
</td>
<td colspan="3"><p>Enable HTTPS for Elasticsearch</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><ul class="simple">
<li><p>ssl</p></li>
</ul>
</td>
<td colspan="3"><p>Enable TLS for Elasticsearch transport connections</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td rowspan="5"><ul class="simple">
<li><p>aaa</p></li>
</ul>
</td>
<td colspan="3"><p>Enable Elasticsearch Authentication, Authorization and Accounting</p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td colspan="2"><p><em>object</em></p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>properties</p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>enabled</p></li>
</ul>
</td>
<td><p>type</p></td>
<td><p><em>boolean</em></p></td>
</tr>
<tr class="row-odd"><td><ul class="simple">
<li><p>audit</p></li>
</ul>
</td>
<td><p>type</p></td>
<td><p><em>boolean</em></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><ul class="simple">
<li><p>cbs</p></li>
</ul>
</td>
<td colspan="3"><p>Enable Elasticsearch Content-Based security</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td colspan="2"><p><em>boolean</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="elassandra-configuration">
<h3>Elassandra configuration<a class="headerlink" href="#elassandra-configuration" title="Permalink to this headline">¶</a></h3>
<p>Elassandra configuration is generated by concatenating files from the following configuration sub-directories in /etc/cassandra:</p>
<ul class="simple">
<li><p>cassandra-env.sh.d</p></li>
<li><p>cassandra.yaml.d</p></li>
<li><p>elasticsearch.yml.d</p></li>
<li><p>jvm.options.d</p></li>
</ul>
<p>Files are loaded in alphanumeric order, so the last file overrides previous settings. You can customize
Elassandra configuration files by defining a Kubernetes configmap where each key is mapped to a file.
Here is an example to customize Cassandra settings from the cassandra.yaml file:</p>
<ol class="arabic simple">
<li><p>Create and deploy your user-config map:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span><span class="o">-</span><span class="n">user</span><span class="o">-</span><span class="n">config</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">default</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">elassandra</span>
    <span class="n">cluster</span><span class="p">:</span> <span class="n">cl1</span>
    <span class="n">datacenter</span><span class="p">:</span> <span class="n">dc1</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">cassandra_yaml_d_user_config_overrides_yaml</span><span class="p">:</span> <span class="o">|</span>
    <span class="n">memtable_cleanup_threshold</span><span class="p">:</span> <span class="mf">0.12</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Patch the elassandraDatacenter CRD to map the user-config map to cassandra.yaml.d/009-user_config_overrides.yaml:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">elassandradatacenter</span> <span class="n">elassandra</span><span class="o">-</span><span class="n">cl1</span><span class="o">-</span><span class="n">dc1</span> <span class="o">--</span><span class="nb">type</span> <span class="n">merge</span> <span class="o">--</span><span class="n">patch</span> <span class="s1">&#39;{&quot;spec&quot;:</span>
    <span class="p">{</span><span class="s2">&quot;userConfigMapVolumeSource&quot;</span><span class="p">:</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;elassandra-cl1-dc1-user-config&quot;</span><span class="p">,</span><span class="s2">&quot;items&quot;</span><span class="p">:[</span>
            <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;cassandra_yaml_d_user_config_overrides_yaml&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;cassandra.yaml.d/009-user_config_overrides.yaml&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span><span class="s2">&quot;logback.xml&quot;</span><span class="p">,</span><span class="s2">&quot;path&quot;</span><span class="p">:</span><span class="s2">&quot;logback.xml&quot;</span><span class="p">}]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>The Elassandra operator detects the CRD change and update per rack statefulsets.</p></li>
</ol>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>If you patch the CRD with a wrong schema, the elassandra operator won’t be able to parse and process it until you fix it.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="advanced-services.html" class="btn btn-neutral float-right" title="Advanced Services" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="operator-setup.html" class="btn btn-neutral float-left" title="Operator setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Strapdata

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>